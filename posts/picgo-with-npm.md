---
categories:
  - ç™½å«–ä¹‹é“
date: "2022-07-08 21:21:53"
tags:
  - Picgo
  - å›¾åºŠ
  - Github Action
  - npm
  - cdn
title: Picgo + GitHub Action + npm æ­å»ºè¶…çˆ½å›¾åºŠ
updated: "2022-07-08 21:20:58"
abbrlink: 5408
cover: "https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220718215706.png"
---

å›¾åºŠï¼Œç”¨äºå°†æœ¬åœ°çš„å›¾ç‰‡ä¸Šä¼ åˆ°äº’è”ç½‘å¹¶ç”Ÿæˆå”¯ä¸€çš„ç›´æ¥é“¾æ¥ï¼Œå¸¸å¸¸ç”¨äºåœ¨ç½‘ç«™ä¸­æ’å…¥å›¾ç‰‡ã€‚ç›®å‰å¸‚é¢ä¸Šæœ‰è®¸å¤šçš„å…¬ç”¨å›¾åºŠï¼Œä½“éªŒä¹Ÿéƒ½è¿˜å¯ä»¥ï¼Œä½†è‡ªå·±çš„å›¾ç‰‡æ”¾åœ¨åˆ«äººçš„æœåŠ¡å™¨å¤šå°‘æœ‰ç‚¹ä¸æ”¾å¿ƒï¼Œè¦æ˜¯è·‘è·¯äº†æ›´æ˜¯ç›´æ¥ç©å®Œã€‚

## Step.1 æ­å»ºnpmå›¾åºŠ

å¸‚é¢ä¸Šæœ‰éå¸¸å¤šçš„npm cdnï¼Œé€šè¿‡è¿™äº›cdnï¼Œæˆ‘ä»¬å¯ä»¥å¼•ç”¨å‘å¸ƒåˆ°npmçš„æ–‡ä»¶ï¼Œä¾‹å¦‚æœ¬ç«™çš„npmåŒ…æ˜¯ `redish101-blog`ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º `1.3.656820088`ï¼Œéœ€è¦è·å– `/public/index.html`ï¼Œé€šè¿‡Jsdelivr Fastlyå¼•ç”¨ï¼Œç›´æ¥é“¾æ¥å°±æ˜¯è¿™æ ·çš„:

```plaintext
https://cdn1.tianli0.top/npm/redish101-blog@1.3.656820088/public/index.html
```

> è¿™é‡Œä¸ºä»€ä¹ˆä½¿ç”¨Fastlyè€Œéä¸»åŸŸå(cdn1.tianli0.top)ï¼š
>
> æœ€è¿‘,Jsdçš„ä¸»åŸŸåè¢«dnsæ±¡æŸ“äº†ï¼ŒFastlyæ˜¯äºšæ´²èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ²¡æœ‰å—åˆ°å½±å“ï¼Œä½†ç”µä¿¡è®¿é—®Fastlyç»å¯¹èƒ½æ€¥æ­»äººï¼Œæ‰€ä»¥ï¼Œåœ¨ç›®å‰æƒ…å†µä¸‹æ¥çœ‹ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨jsdä½œä¸ºcdnæ˜¯éå¸¸æ„šè ¢çš„è¡Œä¸ºï¼Œè¿™å°†å¤§å¹…åº¦æ‹–æ…¢ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚

> 20220702æ›´æ–°: ä¸€ä¸ªä¸å¹¸çš„æ¶ˆæ¯ï¼ŒFastlyä¹Ÿç‚¸äº†ğŸ™

åŒç†ï¼Œä¹Ÿå¯ä»¥è·å–å‘å¸ƒåˆ°npmçš„å›¾ç‰‡ã€‚

### å…·ä½“æ“ä½œ

> åœ¨æ­å»ºnpmå›¾åºŠä¹‹å‰ï¼Œéœ€è¦å®‰è£…npm

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªnpmåŒ…ï¼š

```bash
mkdir redish101-pic # æ–°å»ºæ–‡ä»¶å¤¹ä»¥åˆå§‹åŒ–npmåŒ…
cd redish101-pic # è¿›å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„æ–‡ä»¶å¤¹
npm init # å°†æ–‡ä»¶å¤¹åˆå§‹åŒ–ä¸ºnpmåŒ…
```

ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸­å­˜å…¥å›¾ç‰‡ã€‚å°†éœ€è¦çš„å›¾ç‰‡å­˜å…¥åˆ°ç›®å½•ä¹‹åå‘å¸ƒåˆ°npmï¼š

```bash
npm login # ç™»å½•åˆ°npm
npm publish # ä¸Šä¼ åˆ°npm
```

å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ¬¡ä¸Šä¼ æ²¡æœ‰å‡ºç°ä»»ä½•é—®é¢˜ï¼Œä½†å¦‚æœå†è¯•ä¸€æ¬¡ï¼Œä¼šå‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼š

![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220703211438.png)

è¿™æ˜¯å› ä¸ºnpmä¸å…è®¸å‘å¸ƒé‡å¤çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ–° `package.json`ä¸­çš„ `version`å­—æ®µæ›´æ”¹ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å·éœ€è¦ç¬¦åˆ[è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)ã€‚

ä¸Šä¼ ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–å›¾ç‰‡çš„ç›´æ¥é“¾æ¥äº†ï¼Œæ ¼å¼ä¸€èˆ¬ä¸ºè¿™æ ·ï¼š

```plaintext
https://ä½ çš„cdnåœ°å€/åŒ…å@ç‰ˆæœ¬å·/å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„
```

ä½†jsdæ˜¯ä¸ªä¾‹å¤–ï¼š

```plaintext
https://cdn1.tianli0.top/npm/åŒ…å@ç‰ˆæœ¬å·/ç›¸å¯¹è·¯å¾„
```

è‡³äºå“ªé‡Œæœ‰npm cdnå¯ä»¥ç”¨ï¼Œè¯·è‡ªè¡Œè°·æ­Œï¼Œ101æ¨èelemeã€‚

## Step.2 é›†æˆåˆ°Github

åƒä¸Šé¢è¿™æ ·åœ¨æœ¬åœ°æ“ä½œå›¾ç‰‡æœªå…æœ‰äº›å¤ªéº»çƒ¦äº†ï¼Œè¦æ˜¯æ¢äº†ä¸ªè®¾å¤‡å°±éœ€è¦é‡è£…äº†ï¼Œé‚£ä¹ˆï¼Œå°±è®©æˆ‘ä»¬æŠŠå›¾ç‰‡æ”¾åˆ°Githubã€‚

### å…·ä½“æ“ä½œ

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨Githubæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åéšæ„ï¼Œç„¶åæŠŠæ‰€æœ‰å›¾ç‰‡å­˜åˆ°è¿™ä¸ªä»“åº“é‡Œã€‚ç„¶åå‰å¾€[npmå®˜ç½‘](https://www.npmjs.com/)ï¼Œç”Ÿæˆä¸€ä¸ª`Access Tokens`ï¼Œä¿ç•™å¤‡ç”¨ã€‚

![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220707114628.png)

![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220707114742.png)

![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220707114931.png)

![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220707115044.png)

å›åˆ°Githubï¼Œæ‰“å¼€ä»“åº“è®¾ç½®=>secrets=>Actionï¼Œæ–°å»ºä¸€ä¸ªSecretï¼Œåå­—ä¸º`NPM_TOKEN`ï¼Œå†…å®¹ä¸ºåˆšæ‰ç”Ÿæˆçš„Access Tokenï¼Œä¿å­˜ã€‚

ä¹‹åï¼Œå†™ä¸€ä¸ªciç”¨äºè‡ªåŠ¨å‘å¸ƒnpmåŒ…ï¼Œåœ¨ä»“åº“`.github/workflows`ç›®å½•æ–°å»ºä¸€ä¸ªymlæ–‡ä»¶ä½œä¸ºcié…ç½®æ–‡ä»¶ï¼Œåç§°éšæ„ï¼Œç²˜è´´ä¸‹é¢çš„å†…å®¹ï¼š

```yaml
name: Deploy to NPM CDN
"on":
  - workflow_dispatch
  - push
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: 16.x
      - uses: JS-DevTools/npm-publish@v1
        with:
          token: ${{ secrets.NPM_TOKEN }}
```

è¯•è¯•ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œç­‰å¾…ä¸€ä¼šï¼Œå›¾ç‰‡å°±è‡ªåŠ¨ä¸Šä¼ åˆ°äº†npmï¼Œä½†æˆ‘ä»¬å†ä¸Šä¼ ä¸€éï¼Œä¼šå‡ºç°ä¹‹å‰ç‰ˆæœ¬å·é‡å¤çš„é—®é¢˜ï¼Œå¦‚æœä½ ä¸æƒ³æ¯æ¬¡ä¸Šä¼ éƒ½æ›´æ”¹`packages.json`ï¼Œå¯ä»¥åƒæˆ‘ä¸€æ ·å†™ä¸€ä¸ªå°å°çš„è„šæœ¬ï¼Œå¹¶åœ¨ciä¸­è¿è¡Œï¼Œä¸‹é¢æ˜¯å‚è€ƒï¼š

è„šæœ¬ï¼š

```python
# new_version.py

import json;
import time;

with open("package.json",'r',encoding='utf-8') as f:
    jspack = json.load(f)

new_version = '1.1.'+str(int(time.time()))[1:11:1]
jspack['version']=new_version
with open("package.json",'w',encoding='utf-8') as f:
    json.dump(jspack, f,ensure_ascii=False)
```

cié…ç½®ï¼š

```yaml
name: Deploy to NPM CDN
"on":
  - workflow_dispatch
  - push
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: 16.x
      - run: python3 new_version.py
      - uses: JS-DevTools/npm-publish@v1
        with:
          token: ${{ secrets.NPM_TOKEN }}
```

åˆ°è¿™é‡Œå°±å®Œæˆæ­å»ºäº†ã€‚

## Step.3 é›†æˆåˆ°Picgo

Picgoæ˜¯ä¸€ä¸ªå›¾åºŠå®¢æˆ·ç«¯ï¼Œæ”¯æŒGithubå›¾åºŠï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä¸Šä¼ å›¾ç‰‡ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å»åˆ°[Picgoçš„ä»“åº“](https://github.com/Molunerfinn/PicGo)ï¼Œè¿›å…¥releasesï¼Œéšæ„é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰“å¼€é™„ä»¶åˆ—è¡¨ï¼Œä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„å®‰è£…åŒ…ï¼Œå®‰è£…ï¼Œå¹¶ä¸”æ‰“å¼€Picgoï¼Œè¿›å…¥å›¾åºŠè®¾ç½®=ã€‹GitHubå›¾åºŠï¼Œè¿›è¡Œé…ç½®ï¼š

- **ä»“åº“å**ï¼šå‚¨å­˜å›¾ç‰‡çš„GitHubä»“åº“ï¼Œæ ¼å¼ä¸º`ç”¨æˆ·å/ä»“åº“å`
- **åˆ†æ”¯å**ï¼šå‚¨å­˜å›¾ç‰‡çš„ä»“åº“åˆ†æ”¯
- **Token**ï¼šä½ çš„GitHubå¯†é’¥ï¼Œåœ¨[è¿™é‡Œ](https://github.com/settings/tokens/new)ç”Ÿæˆï¼ŒæŒ‰è¿™å¼ å›¾ç‰‡å¡«å†™ä¿¡æ¯![](https://cdn1.tianli0.top/gh/Redish101/cdn@src/img/20220708210252.png)
- **å›¾ç‰‡è·¯å¾„**ï¼šä¸ç”¨ç®¡
- **è‡ªå®šä¹‰åŸŸå**ï¼šä½ çš„npmåŒ…åœ¨npmçš„è·¯å¾„ï¼Œç‰ˆæœ¬é€‰æ‹©latestï¼Œè¿™é‡Œä»¥jsdä¸ºä¾‹ï¼š`https://cdn1.tianli0.top/npm/åŒ…å@latest/å›¾ç‰‡è·¯å¾„`

ä¿å­˜é…ç½®å¹¶è®¾ç½®ä¸ºé»˜è®¤å›¾åºŠã€‚

## ç¼–è€…çš„è¯

ç»ˆäºæŠŠè¿™ç¯‡æ–‡ç« å†™å‡ºæ¥äº†ï¼Œæœ€è¿‘è¿˜æå¥½äº†æ–°çš„è¯„è®ºç³»ç»Ÿâ€”â€”Artalkï¼Œå¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºã€‚
